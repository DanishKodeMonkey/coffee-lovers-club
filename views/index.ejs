<!DOCTYPE html>
<html>
    <head>
        <title><%= title %></title>
        <link
            rel="stylesheet"
            href="/stylesheets/style.css"
        />
    </head>
    <body>
        <div class="user-content">
            <% if (user) { %>

            <h1>WELCOME BACK <%= user.username %>!</h1>
            <h2>You are currently a <%= user.membership %></h2>
            <% if (user.membership === 'Guest') { %>
            <p>
                Therefore, you may only access the message board in read only
                mode.
            </p>
            <p>
                Want to post? That requires a priviliged secret key! Type it
                below to upgrade to a full fledged member!
            </p>
            <form
                action="/auth/upgrade-user"
                method="post"
            >
                <input
                    type="hidden"
                    name="userId"
                    value="<%= user._id %>"
                />
                <label for="superSecretMemberKey"
                    >Super secret member key:</label
                >
                <input
                    name="superSecretMemberKey"
                    type="password"
                />
                <button>Submit</button>
            </form>
            <% if (errors && errors.length > 0) { %>
            <ul>
                <% errors.forEach(error =>{ %>
                <li><%= error.msg %></li>
                <% }) %>
            </ul>
            <% } %> <% } %>
            <a href="/auth/sign-out">LOG OUT</a>
            <% } else { %>
            <h1>Welcome to the message board!</h1>
            <h2>
                You are currently not signed in, so your access is quite
                limited.
            </h2>
            <p>
                You are welcome to read along on what is being posted on the
                messageboard
            </p>
            <p>If you want to join in, how about signing in?</p>
            <a href="/auth/sign-in">Sign in</a>
            <p>New user?</p>
            <a href="/auth/sign-up">Sign up today!</a> <% } %>
        </div>
        <div class="messageboard">
            <p>Otherwise, feel free to visit the messageboard!</p>
            <a href="/messageboard/messages">Go to messageboard</a>
            <hr />
            <div class="messageboard-preview">
                <h2>Messageboard preview</h2>
                <% if (latestMessages.length) { %>
                <h3>Latest messages:</h3>
                <ul>
                    <% latestMessages.forEach(message =>{ %>
                    <li>
                        <h4><%= message.title %></h4>
                        <p>
                            <%= message.timestamp.toLocaleString('en-GB', {day:
                            'numeric', month: 'short', year: 'numeric', hour:
                            '2-digit', minute: '2-digit', second: '2-digit'}) %>
                        </p>
                        <p><%= message.message %></p>
                    </li>
                    <hr />
                    <% }) %>
                </ul>
                <% } else {%>
                <p>No messages found. Be the first to write!</p>
                <% } %>
            </div>
        </div>
    </body>
</html>
